version: 6
meta:
  description: Test Desc for Sandbox Agent
  icon: >-
    data:image/png;base64,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
  name: Expert Assistant Retail Generic
  protected: true
settings:
  - name: OrderListAPI
    value: 'http://208.43.43.60:9696/search/getOrderListByEmailID/'
    notes: 'List the Orders with details '
  - name: OrderDetailsAPI
    value: 'http://208.43.43.60:9696/search/getOrderDetails/'
    notes: Gives the Order Details for a particular orderNo
secrets:
  - name: password
  - name: username
  - name: xIbmClientSecret
    notes: apic-key
  - name: xIbmClientId
    notes: apic-key
concepts:
  - name: 'oms:OrderEventError'
  - name: 'oms:Error'
  - name: 'oms:OrderSearch'
  - name: 'oms:OrderSearchEvent'
    ontology:
      subClassOf: ':Message'
  - name: 'oms:OrderEvent'
    ontology:
      subClassOf: ':Message'
  - name: ':Message'
  - name: 'oms:Order'
    ontology:
      subClassOf: ':Showable'
      isSpellAs: order
  - name: ':Showable'
patterns: '- show me [order](oms:Order)'
ontobot: ''
actions:
  - name: 'oms:HandleOrderSearchEvent'
    signature: 'oms:OrderSearchEvent -> data oms:OrderSearchEvent'
    kind: 'nodejs:8'
    code: "const request = require(\"request-promise-native\");\r\nconst eba = require(\"eba\");\r\nvar nbaMasterList = require('./nbaMasterListOrderSearch.json')\r\nvar data = require(\"./data.json\")\r\nvar dfOptions = {\r\n\tmethod: 'GET',\r\n\turi: \"\"\r\n}\r\n\r\nmodule.exports.main = async (params) => {\r\n  const h = new eba.Params(params)\r\n  const eventHist = h.storage.history || []  // for building event history later\r\n  const eventData = await h.get(\"oms:OrderSearchEvent\") // taken from @react endpoint\r\n  var enterpriseCode = eventData.orderSearchMeta.EnterpriseCode\r\n  const emailId = eventData.orderSearchMeta.emailID?eventData.orderSearchMeta.emailID:0\r\n  const agentName = eventData.orderSearchMeta.userId\r\n  const phoneNo = eventData.orderSearchMeta.phoneNo\r\n  var fullfilment  = \"STANDARD\"\r\n  var returnList,orderList;\r\n  console.log(eventData.orderSearchMeta.emailID)\r\n  try{\r\n  if(emailId != 0 && emailId == data.Order.EmailID.split(\"@\")[0]){\r\n//For instance the data is stored in EBA generally we make a API call to the Data source\r\n  orderList = data\r\n  }\r\n}\r\n  catch(e){\r\n    apiStatus = 0 ;\r\n    console.log(e)\r\n    const ErrorMessage = {\r\n    text: \" \",\r\n    data: {\r\n      apiStatus:apiStatus\r\n    },\r\n    name:\"oms:OrderSearchEvent\"\r\n    }\r\n    throw 'Could Get the relevant results'\r\n  }\r\n  \r\n  \r\n  console.log(orderList.Order.OrderList)\r\n  var listOrders = orderList.Order.OrderList\r\n \r\n  console.log(listOrders)\r\n  var AOV = 0;\r\n  var OV = 0;\r\n  var RR =0;\r\n  var revenue = 0;\r\n  try{\r\n    AOV = listOrders[0].Analytical.AOV\r\n    RR = listOrders[0].Analytical.ReturnRate\r\n    revenue = listOrders[0].Analytical.PAS\r\n  }\r\n  catch(e){\r\n    console.log(e)\r\n      }\r\n  \r\n  \r\n\r\n\r\n  // construct message variable\r\n  var nbaValid ={}\r\n\tvar finalNBAList = []\r\n\tvar currentDate,orderCreatedDate, orderStatus\r\n  currentDate= new Date()\r\n  \r\n  //Now hardcoded ... Do it Later from currOrder\r\n  \r\n  nbaMasterList.NBAList.forEach(function(currNBA){\r\n    listOrders.forEach(function(currOrder){\r\n    \t//console.log(\"1\")\r\n    \tfunction getSum(total, num) {\r\n        return total + Math.round(num.LineOverallTotals.LineTotal);\r\n      }\r\n      OV = currOrder.OrderTotal\r\n    \tvar createdDate = currOrder.OrderDate\r\n      orderStatus = currOrder.orderStatus\r\n\r\n    \tvar isValidNBA = currNBA.Conditions.every(function(CurrCondition){\r\n    \t\t//console.log(eval(CurrCondition))\r\n    \t\tif (! eval(CurrCondition)){\r\n    \t\t\treturn false;\r\n    \t\t}\r\n    \t\treturn true;\r\n    \t})\r\n    \t\r\n    \t\r\n    \t//console.log(validNBA)\r\n    \tif(isValidNBA){\r\n    \t\t//console.log(\"success!!!\")\r\n    \t\tnbaValid = new Object()\r\n    \t\tnbaValid[\"Action\"]=currNBA.Action\r\n    \t\tnbaValid[\"ActionID\"]=currNBA.ActionID\r\n    \t\tnbaValid[\"NBAType\"]= currNBA.NBAType\r\n    \t\tnbaValid[\"Facts\"]= []\r\n    \t\tnbaValid[\"NBAData\"]={}\r\n    \t\tnbaValid[\"Highlight\"]= currNBA.Highlight\r\n    \t\tnbaValid.NBAData[\"OrderNo\"]=currOrder.OrderNo\r\n    \t\tnbaValid.NBAData[\"EnterpriseCode\"]=\"Matrix\"\r\n    \t\tnbaValid.NBAData[\"URL\"]= currOrder.url?currOrder.url:\"www.goole.com\"\r\n    \t\tcurrNBA.Facts.forEach(function(fact){\r\n    \t\t\tnbaValid[\"Facts\"].push(eval(\"`\"+fact+\"`\"))\r\n    \t\t})\r\n    \t\tfinalNBAList.push(nbaValid)\r\n    \t}\r\n  \r\n  })\r\n  });\r\n  const message = {\r\n    text: \" \",\r\n    data: {\r\n      customerName: listOrders.CustomerFirstName +\" \"+ listOrders.CustomerLastName,\r\n      customerSince: listOrders.CustomerSince,\r\n      finalNBAList: finalNBAList,\r\n      emailId: emailId,\r\n\t\t\torderList:listOrders,\r\n\t\t\tcallReason:  \"Availaible Soon\",\r\n\t\t\tCustomerName:listOrders.CustomerFirstName +\" \"+ listOrders.CustomerLastName,\r\n\t\t\tCustomerSince: listOrders.CustomerSince,\r\n\t\t\treturnRate: RR,\r\n\t\t\tRevenue: revenue,\r\n\t\t\tOrderValue:OV,\r\n\t\t\tAOV: AOV,\r\n\t\t\t//churnScore: churnScore, \r\n\t\t\t\tNBAList: {\r\n\t\t\t\t\tNBA:finalNBAList,\r\n\t\t\t\t\tlen:finalNBAList.length\r\n\t\t\t\t},\r\n\t\t\t\tNBAData: {\r\n\t\t\t\t\tEntripriseCode:\"\" ,\r\n\t\t\t\t\tOrderNo: \"\",\r\n\t\t\t\t\tURL: \"\"\r\n\t\t\t\t}\r\n\t\t},\r\n\t\tname:\"oms:OrderSearchEvent\"\r\n  }\r\n  \r\n  \r\n  // send data to EBA infromation space\r\n  return new eba.Result()\r\n    // stores history for next time\r\n    .store(\"history\", eventHist.concat(eventData))\r\n    // important tag makes data visible in compact mode\r\n    .addTags(\"oms:OrderSearchEvent\", \"important\")\r\n    // sets data as message variable above\r\n    .setData(\"oms:OrderSearchEvent\", message)\r\n}\r\n\r\n\r\n\r\n"
  - name: 'oms:HandleOrderEvent'
    signature: 'oms:OrderEvent -> data oms:OrderEvent'
    kind: 'nodejs:8'
    code: "const request = require(\"request-promise-native\");\r\nconst nbalist = require('./templates/nba.json'); \r\nconst eba = require(\"eba\");\r\nvar nbaMasterList = require('./nbaMasterListOrderSummary.json')\r\nvar data = require(\"./data.json\")\r\n\r\nvar shopper_scoring=\"\"\r\nvar payload_scoring = \"\"\r\nvar finalNBAList = []\r\nvar dfOptions = {\r\n\tmethod: 'GET',\r\n\turi: \"\"\r\n} \r\nvar dfOptions1 = {\r\n\tmethod: 'GET',\r\n\turi: \"\",\r\n\theaders: {\r\n\t\t'Content-Type':'application/json',\r\n\t\t'x-ibm-client-id': '',\r\n\t\t'x-ibm-client-secret':''\r\n\t}\r\n}\r\n\r\nmodule.exports.main = async (params) => {\r\n  const h = new eba.Params(params)\r\n  const eventHist = h.storage.history || []  // for building event history later\r\n  const eventData = await h.get(\"oms:OrderEvent\") // taken from @react endpoint\r\n  const orderId = eventData.orderMeta.orderID\r\n  const emailId = eventData.orderMeta.emailID\r\n  const agentName = eventData.orderMeta.userId\r\n  const phoneNo = eventData.orderMeta.phoneNo\r\n  console.log(orderId)\r\n  var mlHeaders = {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + params.storage.mlToken}\r\n  console.log(eventHist)\r\n  //get the item related data \r\n  var scoring = {\"fields\":[ \"BASKET_SIZE\", \"EXTN_COMPOSITION\", \"CARRIER_SERVICE_CODE_OL\", \"CATEGORY\", \"COUNTRY_OF_ORIGIN_OI\", \"DAY_OF_MONTH\", \"DAY_OF_WEEK\", \"DAY_OF_YEAR\", \"ENTERPRISE_KEY\", \"EXTN_BRAND\", \"EXTN_CHRISTMAS_GUARANTEE\", \"EXTN_IS_FAST_DELIVERY\", \"EXTN_IS_GIFT\", \"EXTN_IS_PREORDER\", \"EXTN_SEASON\", \"LIST_PRICE\", \"MONTH_OF_YEAR\", \"OTHER_CHARGES\", \"OTHER_CHARGES_OL\", \"TOTAL_AMOUNT_USD\", \"WEEKEND\", \"ZIP_CODES\", \"REQ_DELIVERY_DATE\", \"EXTN_DISCOUNT_ID\", \"EXTN_SHIP_TO_CITY\", \"EXTN_SHIP_TO_COUNTRY\"], \"values\":[[]] }\r\n  var mlOptions = {\r\n\t\tmethod: 'POST',\r\n\t\turi: \"<URL>\",\r\n\t\theaders: mlHeaders,\r\n\t\tbody: JSON.stringify(scoring)\r\n\t}\r\n\t\r\n\r\n  var revenue = 0;\r\n  var RR = 0;\r\n  var AOV =0;\r\n  var RP = 0;\r\n  lifeTimeValue =0\r\n  var returnWinDays= 28\r\n  cScore = 0\r\n  message1 = []\r\n\r\n  try{ \r\n    apiStatus = 1\r\n  Rosa.Order.OrderList.forEach(function(currOrder){\r\n    if (currOrder.OrderNo == orderId)\r\n       orderDetails = currOrder\r\n  })\r\n  console.log(JSON.stringify(orderDetails))\r\n  }\r\n  catch(e){\r\n    apiStatus = 0 ;\r\n    console.log(e)\r\n    const ErrorMessage = {\r\n    text: \" \",\r\n    data: {\r\n      apiStatus:apiStatus\r\n    },\r\n    name:\"oms:OrderEvent\"\r\n    }\r\n    throw 'No relevant Information Found' \r\n  }\r\n  \r\n  var orderListLength = \"1\"\r\n  var actualDate=0;\r\n  if(apiStatus == 1){\r\n  try{\r\n  insights = orderDetails.Ml?orderDetails.Ml:{}\r\n  }catch(e)\r\n  {\r\n    insights = {}\r\n    console.log(e)\r\n  }\r\n  \r\n  if (JSON.stringify(insights) == JSON.stringify({})){\r\n    \tchurnScore = \"API is Down\",\r\n    \tCLTV= \"API is Down\",\r\n    \tReturnRate=\"API is Down\",\r\n    \treturnRate =\"API is Down\"\r\n    \trevenue=\"API is Down\",\r\n    \tAOV=\"API is Down\"\r\n  } \r\n  else{\r\n  CLTV= insights.CLTV\r\n\r\n  lifeTimeValue = insights.CLTV \r\n  churnScore = insights.Churn\r\n  revenue = orderDetails.Analytical.PAS\r\n  //= currency[\"currency\"][orderDetailsJson.OrderDetails.Currency] +\" \"+revenue\r\n  RR = orderDetails.Analytical.ReturnRate \r\n  returnRate = parseFloat(RR.split(\"%\")[0])\r\n  AOV = orderDetails.Analytical.AOV\r\n  cScore = parseFloat(churnScore.split(\"%\")[0])\r\n  }\r\n  fullfilment = \"\"\r\n  \r\n  var returnValues=[]\r\n  //var fullfilment = orderDetailsJson.OrderDetails.OrderLines.OrderLine[0].CarrierServiceCode;\r\n  try{\r\n    \tmlResponse = await request(mlOptions)\r\n\t   console.log(JSON.parse(mlResponse).values[0])\r\n\r\n      RP = Math.round(JSON.parse(mlResponse).values[0][JSON.parse(mlResponse).values[0].length-1][0]*100) ,\r\n      returnPropensity = RP.toString()+\"%\"\r\n      descItem = orderDetails.ItemDesc;\r\n      error = \"\"\r\n  }catch(e){\r\n    console.log(\"return propensity block\")\r\n    console.log(e)\r\n    error = e\r\n    returnPropensity = \"API is Down\";\r\n    descItem =\"\"\r\n  }\r\n  try{\r\n    shopperAffinity = insights.ShopperAffinity\r\n  }catch(e){\r\n    console.log(\"shopper affinity block\")\r\n    console.log(e)\r\n    shopperAffinity = \"API is Down \";\r\n  }\r\n   try{\r\n    predReturnDays = \"1-10 days\"\r\n  }catch(e){\r\n    console.log(\"return days api block\")\r\n    console.log(e)\r\n    error = e.toString()\r\n    predReturnDays = 0;\r\n  }\r\n  \r\n  OV =orderDetails.OrderTotal\r\n  createdDate = orderDetails.OrderDate\r\n  orderStatus = orderDetails.OrderStatus\r\n\r\n  \r\n  nbaMasterList.NBAList.forEach(function(currNBA){\r\n      var isValidNBA = currNBA.Conditions.every(function(CurrCondition){\r\n        console.log(\"eval\"+eval(CurrCondition))\r\n          if (! eval(CurrCondition)){\r\n              return false;\r\n          }\r\n          return true;\r\n      })\r\n      if(isValidNBA){\r\n          //console.log(\"success!!!\")\r\n          nbaValid = new Object()\r\n          nbaValid[\"Action\"]=currNBA.Action\r\n          nbaValid[\"ActionID\"]=currNBA.ActionID\r\n          nbaValid[\"NBAType\"]= currNBA.NBAType\r\n          nbaValid[\"Facts\"]= []\r\n          nbaValid[\"Highlight\"]=currNBA.Highlight \r\n          nbaValid[\"NBAData\"]={}\r\n          nbaValid.NBAData[\"OrderNo\"]=orderDetails.OrderNo\r\n          nbaValid.NBAData[\"EnterpriseCode\"]=\"Matrix\"\r\n          nbaValid.NBAData[\"URL\"]=\"test\";\r\n          currNBA.Facts.forEach(function(fact){\r\n              nbaValid[\"Facts\"].push(eval(\"`\"+fact+\"`\"))\r\n          })\r\n          finalNBAList.push(nbaValid)\r\n      }\r\n      //console.log(finalNBAList)\r\n  });\r\n  \r\n  }\r\n  const message = {\r\n    text: \" \",\r\n    data: {\r\n      customerName : orderDetails.CustomerFirstName +\" \"+orderDetails.CustomerLastName,\r\n      customerSince : orderDetails.CustomerSince,\r\n      orderId: orderId,\r\n      predReturnDay:predReturnDays,\r\n      aov: insights.AOV,\r\n      insights:insights,\r\n      apiStatus:apiStatus,\r\n      reasonCode:\"Damage Product\",\r\n      os: orderStatus,\r\n      orderCreatedDate: createdDate,\r\n      error: error?error:\"\",\r\n      returnStatus: RP > 75 ? \"true\":\"false\",\r\n      AOV: AOV,\r\n      CLTV: CLTV,\r\n      descItem: descItem,\r\n      //index1: index1,\r\n      callReason:  \"Available Soon!!\",\r\n      churnScore: churnScore , \r\n      returnPropensity: returnPropensity,\r\n      shopperAffinity: shopperAffinity,\r\n      returnRate: RR ,\r\n      Revenue: revenue,\r\n      OrderValue:orderDetails.OrderTotal,\r\n      CustomerID: \"\",\r\n      NBAList: {\r\n         NBA:finalNBAList,\r\n         len:finalNBAList.length\r\n      },\r\n      NBAData: {\r\n         EntripriseCode:\"\" ,\r\n         OrderNo: orderDetails.OrderNo\r\n      }\r\n    },\r\n    name:\"oms:OrderEvent\"\r\n  }\r\n  finalNBAList = []\r\n    // send data to EBA infromation space\r\n  return new eba.Result()\r\n \r\n  //.store(\"history\", eventHist.concat(message))\r\n  // important tag makes data visible in compact mode\r\n  .addTags(\"oms:OrderEvent\", \"important\")\r\n  // sets data as message variable above\r\n  .setData(\"oms:OrderEvent\", message)\r\n  \r\n}\r\n\r\n\r\n\r\n"
endpoints:
  - name: '@api'
    kind: 'nodejs:8'
    code: ''
  - name: '@start'
    kind: 'nodejs:8'
    code: "const request = require(\"request-promise-native\");\nconst {Result} = require('eba');\nmodule.exports.main = async (params) => {\n   \n  console.log(params)\n   wml_credentials={\n\t  username: params.secrets.username,\n\t  password: params.secrets.password\n\t}\n\tauth = \"Basic \" + new Buffer.from(wml_credentials.username + \":\" + wml_credentials.password).toString(\"base64\");\n  var options = {\n  \t  method: 'GET',\n  \t  uri: 'http://caplonsgprd-3.securegateway.appdomain.cloud:15942/v1/preauth/validateAuth',\n  \t  headers: {\n  \t\t'User-Agent': 'Request-Promise',\n  \t\t'Authorization': auth\n  \t  }\n  \t}\n\tconst wsResponse = await request(options)\n\tmlToken = JSON.parse(wsResponse).accessToken\n\tconsole.log(mlToken)\n\treturn new Result().store('agentName', params.agent).store('mlToken', mlToken)\n}"
    limits:
      memory: 1024
      timeout: 120000
  - name: '@react'
    kind: 'nodejs:8'
    code: |-
      module.exports.main = function(params) {
        let repr = params.input.repr
        let name = "oms:Event";
        // this sample supports one event, viz. OrderEvent
        if (repr.data.orderMeta) name = "oms:OrderEvent"
        else if(repr.data.orderSearchMeta) name = "oms:OrderSearchEvent"
        
        return {
          output: {
            name: name,
            type: "concept",
            data: repr.data
          }
        };
      }
statics:
  - name: data.json
    mime: application/json
    text: |-
      {"Order":{ 
         "CustomerFirstName": "Jossie",
         "EmailID":"Jossie@gmail.com",
         "CustomerLastName":"Weasley",
         "CustomerSince":"2019",
         "orderStatus":"Created",
         "OrderDate":"22 June 2019",
         "OrderNo":"Y100000100",
         "OrderTotal":"$ 125",
         "OrderList":[{
         "ItemDesc":"XYZ Women Clutch",
          "Ml":{
           "CLTV":"$1234",
           "Churn":"45%",
           "ReturnRisk":"63%",
           "ShopperAffinity":"75%"
           
         },
         "Analytical":{
           "AOV":"$124",
           "ReturnRate":"45%",
           "PAS":"$452"
         }
        
      }]}}
    frontend: true
    backend: true
  - name: main.js
    mime: text/javascript
    text: |-
      document.body.classList.add("oms-root")
      try {
        if (window.self != window.top)
          document.body.classList.add("oms-compact")
      }
      catch {}
      $(window).on("message", function(event) {
        if (event.originalEvent)
          switch (event.originalEvent.data) {
            case "show": document.body.classList.remove("oms-compact"); break;
            case "hide": document.body.classList.add("oms-compact"); break
          }
      })
    frontend: true
    backend: true
  - name: templates/Predictionfields.jsx
    mime: text/jsx
    text: "var oms_CLTVField = class EventData extends React.PureComponent {\r\n        constructor(props) {\r\n          super(props)\r\n          this.state = { selectedAction: 0, feedback : null, feedbackClass:\"cca-node-feedback cca-node-feedback-null\"}\r\n        }\r\n\r\n        \r\n        render() {\r\n          var divstyle = {\r\n            display: 'inline-block'\r\n          };\r\n          var divheader = {\r\n            display: 'inline-block'\r\n          };\r\n          divheader[\"font-weight\"] = 'bold'\r\n          //console.log(\"oms_InsightsData.render\");\r\n          let customerSince = this.props.data.customerSince\r\n          let cutomerName = this.props.data.customerName\r\n          let cltvvalue = this.props.data.CLTV\r\n          let churnScore = this.props.data.churnScore\r\n          let shopperAffinity = this.props.data.shopperAffinity\r\n          \r\n          let feedbackClass = \"cca-node-feedback cca-node-feedback-\"+this.state.feedback\r\n\r\n          return (\r\n                 <div>\r\n                   <div>\r\n                   <table>\r\n                      <tr>\r\n                        <td><div style={divstyle} className=\"font-key\">Customer Abandonment</div></td>\r\n                        <td align=\"right\" className=\"font-value\"><div style={divstyle}>{churnScore}</div></td>\r\n                      </tr>\r\n                      <tr>\r\n                        <td><div style={divstyle} className=\"font-key\">Shopper Affinity</div></td>\r\n                        <td align=\"right\" className=\"font-value\"><div style={divstyle}>{shopperAffinity}</div></td>\r\n                      </tr>\r\n                      <tr>\r\n                        <td><div style={divstyle} className=\"font-key\">Projected LTV</div></td>\r\n                        <td align=\"right\" className=\"font-value\"><div style={divstyle}>{cltvvalue}</div></td>\r\n                      </tr>\r\n                   </table>\r\n                   <div className=\"hr\"></div>\r\n                   </div>\r\n                   <div ref=\"myDiv\">\r\n                   </div>\r\n                 </div>)\r\n        }\r\n      } \r\n      \r\nvar oms_returnRiskField = class EventData extends React.PureComponent {\r\n        constructor(props) {\r\n          super(props)\r\n          this.state = { selectedAction: 0 ,feedback : null}\r\n        }\r\n\r\n        render() {\r\n          var divstyle = {\r\n            display: 'inline-block'\r\n          };\r\n          var divheader = {\r\n            display: 'inline-block'\r\n          };\r\n          var divstyle1 = {\r\n            color: 'black'\r\n          }\r\n          \r\n          divheader[\"font-weight\"] = 'bold'\r\n          //console.log(\"oms_InsightsData.render\");\r\n          let reason= \"\";\r\n          let returnvalue = this.props.data.returnPropensity\r\n          let returnableDays = this.props.data.predReturnDay\r\n          let item = this.props.data.descItem\r\n          let returnStatus = this.props.data.returnStatus\r\n          let desc = String(this.props.data.descItem)\r\n          let feedbackClass = \"cca-node-feedback cca-node-feedback-\"+this.state.feedback\r\n          let returnDays = \"\"\r\n          let returnReasonCode = this.props.data.reasonCode\r\n          if(returnStatus == \"true\")\r\n          {\r\n             returnDays = <table>\r\n             <tr>\r\n             <td><div style={divstyle} className=\"font-key\">Predicted Days To Return</div></td>\r\n             <td align=\"right\" className=\"font-value\"><div style={divstyle} title={item}>{returnableDays}</div></td>\r\n             </tr>\r\n             </table>\r\n          }\r\n\r\n         return (\r\n           <div>\r\n             <div>\r\n             <table>\r\n             <tr>\r\n               <td><div style={divstyle} className=\"font-key\" title=\"Predicted Return Risk\">Item Return Risk</div></td>\r\n               <td align=\"right\" className=\"font-value\"><div style={divstyle} title={item}>{returnvalue}</div></td>\r\n             </tr>\r\n             </table>\r\n             <div> <span style={divstyle1} className=\"glyphicon glyphicon-error-circle-16\"/><div style={divstyle} className=\"font-item\">&nbsp;{desc}</div></div>\r\n               {returnDays}\r\n               <table>\r\n                  <tr>\r\n                     <td><div style={divstyle} className=\"font-key\" title=\"Return Reason\">Previous Significant Reason</div></td>\r\n                     <td align=\"right\" className=\"font-value\"><div style={divstyle} title={item}>{returnReasonCode}</div></td>\r\n                  </tr>\r\n             </table>\r\n              {/* <div style={divstyle} className={feedbackClass}>\r\n                    <a href=\"#\" className=\"positive\" onClick={this.handleUp.bind(this)} >\r\n                   <ThumbsUpIcon /> &nbsp;\r\n                 </a>\r\n                 <a href=\"#\" className=\"negative\" onClick={this.handleDown.bind(this)}>\r\n                   <ThumbsDownIcon />\r\n                 </a>-->\r\n               </div> */}\r\n\r\n             </div>\r\n             <div className=\"hr\"></div>\r\n           </div>\r\n         )\r\n        }\r\n      } \r\nvar oms_searchField = class EventData extends React.PureComponent {\r\n    constructor(props) {\r\n      super(props)\r\n      this.state = { selectedAction: 0, feedback : null, feedbackClass:\"cca-node-feedback cca-node-feedback-null\"}\r\n  }\r\n\r\n\r\n  render() {\r\n    var divstyle = {\r\n      display: 'inline-block'\r\n    };\r\n    //console.log(\"oms_InsightsData.render\");\r\n    let customerSince = this.props.data.customerSince\r\n    let cutomerName = this.props.data.customerName\r\n    let feedbackClass = \"cca-node-feedback cca-node-feedback-\"+this.state.feedback\r\n    return (\r\n       <div>\r\n         <div className=\"head\">AGENT PHIL</div>\r\n         <br></br>\r\n         <div className=\"padding\">\r\n           <table>\r\n              <tr>\r\n                <td><div className=\"font-key\">Customer since</div></td>\r\n                <td align=\"right\" className=\"font-value\"><div style={divstyle}>{customerSince}</div></td>\r\n              </tr>\r\n           </table>\r\n          </div>\r\n       </div>\r\n       )\r\n  }\r\n}\r\n\r\nvar more_details = class EventData extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = { selectedAction: 0 ,feedback : null}\r\n  }\r\n  render() {\r\n    var divstyle = {\r\n      display: 'inline-block'\r\n    };\r\n    var divheader = {\r\n      display: 'inline-block'\r\n    };\r\n    \r\n    let rr = this.props.data.returnRate\r\n    let AOV = this.props.data.AOV\r\n    let revenue = this.props.data.Revenue\r\n    \r\n    return (\r\n      <div>\r\n        <table>\r\n          <tr>\r\n            <td><div style={divstyle} className=\"font-key\">Return Rate</div></td>\r\n            <td align=\"right\" className=\"font-value\"><div style={divstyle}>{rr}</div></td>\r\n          </tr>\r\n          <tr>\r\n            <td><div style={divstyle} className=\"font-key\">Average Order Value</div></td>\r\n            <td align=\"right\" className=\"font-value\"><div style={divstyle} >{AOV}</div></td>\r\n          </tr>\r\n          <tr>\r\n            <td><div style={divstyle} className=\"font-key\" >Previous Annual Spend</div></td>\r\n            <td align=\"right\" className=\"font-value\"><div style={divstyle}>{revenue}</div></td>\r\n          </tr>\r\n        </table>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n"
    frontend: true
  - name: nbaMasterListOrderSearch.json
    mime: application/json
    text: "{\r\n\t\"NBAList\":[{\r\n\t\t\"Action\": \"View Order\",\r\n\t\t\"ActionID\": \"ViewOrder\",\r\n\t\t\"NBAType\": \"CCUI-URL\",\r\n\t\t\"Comments\": \"Delayed Order\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\"orderStatus == \\\"Scheduled\\\"\"\r\n\t\t\t\t\t\t\t\t],\r\n\t\t\"Facts\":[\"Delayed Order\",\"Order worth ${OV}  created on ${createdDate.toString().slice(0,15)} with  ${fullfilment} Shipping \"]\r\n\t},\r\n\t{\r\n\t\t\"Action\": \"View Order\",\r\n\t\t\"ActionID\": \"ViewOrder\",\r\n\t\t\"NBAType\": \"CCUI-URL\",\r\n\t\t\"Comments\": \"Just recently placed order\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\"orderStatus == \\\"Created\\\"\"\r\n\t\t],\r\n\t\t\"Facts\":[\"Order worth ${OV}  created on ${createdDate.toString().slice(0,15)} with  ${fullfilment} Shipping \"]\r\n\t},\r\n\t{\r\n\t\t\"Action\": \"View Order\",\r\n\t\t\"ActionID\": \"ViewOrder\",\r\n\t\t\"NBAType\": \"CCUI-URL\",\r\n\t\t\"Comments\": \"Just recently placed order\",\r\n\t\t\"Highlight\":\"return\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\t\"orderStatus == \\\"Shipped and Invoiced\\\"\"\r\n\t\t],\r\n\t\t\"Facts\":[\"Return Request\",\"Order worth ${OV}  created on ${createdDate.toString().slice(0,15)} with  ${fullfilment} Shipping \"]\r\n\t},\r\n\t{\r\n\t\t\"Action\": \"NONE\",\r\n\t\t\"ActionID\": \"ChangeShipmentAddress\",\r\n\t\t\"NBAType\": \"CCUI-URL\",\r\n\t\t\"Comments\": \"Just recently placed order\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\" finalNBAList.length==0 \"\r\n\t\t],\r\n\t\t\"Facts\":[\"No NBA - Server Down/Decision Matrix Criteria not matching\"]\r\n\t}]\r\n}"
    backend: true
  - name: nbaMasterListOrderSummary.json
    mime: application/json
    text: "{\r\n\t\"NBAList\":[{\r\n\t\t\"Action\": \"Follow Up With Customer\",\r\n\t\t\"ActionID\": \"ViewShipment\",\r\n\t\t\"NBAType\": \"CCUI-INFO\",\r\n\t\t\"Comments\": \"First Time Customer Order\",\r\n\t\t\"Highlight\": \"first\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\"false\"\r\n\t\t],\r\n\t\t\"Facts\":[\"First Time Customer\"]\r\n\t},\r\n\t{\r\n\t\t\"Action\": \"Suggest Promo Code\",\r\n\t\t\"ActionID\": \"\",\r\n\t\t\"NBAType\": \"CCUI-INFO\",\r\n\t\t\"Comments\": \"Delayed Order\",\r\n\t\t\"Highlight\": \"none\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\"30<50\"\r\n\t\t],\r\n\t\t\"Facts\":[\"Order worth ${OV} created on ${createdDate} with ${fullfilment} shipping type now in ${orderStatus} status.\"]\r\n\t},\r\n\t{\r\n\t\t\"Action\": \"Offer Price Adjustment\",\r\n\t\t\"ActionID\": \"\",\r\n\t\t\"NBAType\": \"CCUI-URL\",\r\n\t\t\"Comments\": \"Delayed Order\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\"false\"\r\n\t\t\t\r\n\t\t],\r\n\t\t\"Facts\":[\"Delayed Order\"]\r\n\t},\r\n\t{\r\n\t\t\"Action\": \"View Shipment\",\r\n\t\t\"ActionID\": \"ViewShipment\",\r\n\t\t\"NBAType\": \"CCUI-URL\",\r\n\t\t\"Comments\": \"Delayed Order\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\"orderStatus == \\\"shipped\\\"\"\r\n\t\t],\r\n\t\t\"Facts\":[\"Order in Scheduled and ESD on ${ESD.toString().slice(0,15)}\",\"Created on ${orderCreatedDate.toString().slice(0,15)}\"]\r\n\t},\r\n\t{\r\n\t\t\"Action\": \"Change Ship Address\",\r\n\t\t\"ActionID\": \"ChangeShipmentAddress\",\r\n\t\t\"NBAType\": \"CCUI-URL\",\r\n\t\t\"Comments\": \"Just recently placed order\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\"false\"\r\n\t\t],\r\n\t\t\"Facts\":[\"Order just placed at ${orderCreatedDate.toString().slice(0,15)}\"]\r\n\t},{\r\n\t\t\"Action\": \"Suggest Promo Code\",\r\n\t\t\"ActionID\": \"\",\r\n\t\t\"NBAType\": \"CCUI-INFO\",\r\n\t\t\"Comments\": \"Delayed Order\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\"orderStatus == \\\"Scheduled\\\"\"\r\n\t\t\t\r\n\t\t],\r\n\t\t\"Facts\":[\"Delayed Order\"]\r\n\t},\r\n\t{\r\n\t\t\"Action\": \"Suggest Promo Code\",\r\n\t\t\"ActionID\": \"\",\r\n\t\t\"NBAType\": \"CCUI-INFO\",\r\n\t\t\"Comments\": \"Delayed Order\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n       \"false\"\r\n\t\t],\r\n\t\t\"Facts\":[\"Delayed Order\"]\r\n\t},{\r\n\t\t\"Action\": \"Resolve Holds\",\r\n\t\t\"ActionID\": \"ResolveHolds\",\r\n\t\t\"NBAType\": \"CCUI-URL\",\r\n\t\t\"Comments\": \"Order with Holds\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t  \"true\" \r\n\t\t \r\n\t\t],\r\n\t\t\"Facts\":[\"Order is on Hold\"] \r\n\t},\r\n\t{\r\n\t\t\"Action\": \"Recommend New Arrivals\",\r\n\t\t\"ActionID\": \"\",\r\n\t\t\"NBAType\": \"CCUI-INFO\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Comments\": \"Order Recently Created\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\"lifeTimeValue > 10000\",\r\n\t\t\t\t\"cScore < 30\"\r\n\t\t],\r\n\t\t\"Facts\":[\"High Projected LTV\"]\r\n\t},\r\n\t{\r\n\t\t\"Action\": \"Resolve Holds\",\r\n\t\t\"ActionID\": \"ResolveHolds\",\r\n\t\t\"NBAType\": \"CCUI-URL\",\r\n\t\t\"Comments\": \"Order with Holds\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t  \"false\"\r\n\t\t],\r\n\t\t\"Facts\":[\"Order worth € ${OV} created on ${createdDate.toString().slice(0,15)} with ${fullfilment} shipping type in ${orderStatus} status.\"] \r\n\t},\r\n\t{\r\n\t\t\"Action\": \"View Tracking\",\r\n\t\t\"ActionID\": \"ViewTracking\",\r\n\t\t\"NBAType\": \"EBA-URL\",\r\n\t\t\"Comments\": \"Just recently placed order\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t  \"orderStatus == \\\"Shipped\\\"\"\r\n\t\t],\r\n\t\t\"Facts\":[\"Order worth € ${OV} created on ${createdDate.toString().slice(0,15)} with ${fullfilment} shipping type now in ${orderStatus} status.\"\r\n\t\t] \r\n\t},\r\n\t{\r\n\t\t\"Action\": \"Suggest Upsell Order\",\r\n\t\t\"ActionID\": \"\",\r\n\t\t\"NBAType\": \"CCUI-URL\",\r\n\t\t\"Comments\": \"Order Cancelled\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\"orderStatus == \\\"Cancelled\\\"\",\r\n\t\t\t\"lifeTimeValue > 85\"\r\n\t\t],\r\n\t\t\"Facts\":[\"High Return Rish for Item ${orderDetails.OrderLines.OrderLine[0].Item.ItemShortDesc}\",\"Order worth € ${OV} created on ${createdDate.toString().slice(0,15)} with ${fullfilment} shipping type now in ${orderStatus} status.\"]\r\n\t},\r\n\t{\r\n\t\t\"Action\": \"View Tracking\",\r\n\t\t\"ActionID\": \"ViewTracking\",\r\n\t\t\"NBAType\": \"EBA-URL\",\r\n\t\t\"Comments\": \"Just recently placed order\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n    \"orderStatus == \\\"Shipped and Invoiced\\\" | orderStatus == \\\"Shipped\\\"\"\r\n\t\t],\r\n\t\t\"Facts\":[\"Order worth ${OV} created on ${createdDate.toString().slice(0,15)} with ${fullfilment} shipping type now in ${orderStatus} status.\"\r\n\t\t] \r\n\t},\r\n\t{\r\n\t\t\"Action\": \"Return Rules\",\r\n\t\t\"ActionID\": \"\",\r\n\t\t\"NBAType\": \"EBA-URL\",\r\n\t\t\"Comments\": \"Return/Exchange Orders\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\"orderStatus == \\\"Shipped And Invoiced\\\"\"\r\n\t\t],\r\n\t\t\"Facts\":[\"Return Window Passed ${returnDays} days\"]\r\n\t},\r\n{\r\n\t\t\"Action\": \"View Return Policy\",\r\n\t\t\"ActionID\": \"\",\r\n\t\t\"NBAType\": \"EBA-URL\",\r\n\t\t\"Comments\": \"Return/Exchange Orders\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t  \"orderStatus == \\\"Shipped and Invoiced\\\"\"\r\n\t\t],\r\n\t\t\"Facts\":[\"Within return window\"]\r\n\t},\r\n\t{\r\n\t\t\"Action\": \"NONE\",\r\n\t\t\"ActionID\": \"ChangeShipmentAddress\",\r\n\t\t\"NBAType\": \"CCUI-URL\",\r\n\t\t\"Comments\": \"Just recently placed order\",\r\n\t\t\"Highlight\":\"none\",\r\n\t\t\"Conditions\":[\r\n\t\t\t\"orderListLength == 0 || finalNBAList.length==0 \"\r\n\t\t],\r\n\t\t\"Facts\":[\"No NBA - Server Down/Decision Matrix Criteria not matching\"]\r\n\t}\r\n\t]\r\n}"
    backend: true
  - name: templates/orderSearchEvent.js
    mime: text/javascript
    text: >-
      var oms_OrderSearchEventData = class oms_OrderSearchEventData extends
      React.PureComponent  {
        constructor(props) {
          super(props)
        }
        
        render() {
            console.log("oms_OrderDetailsData.render");
            var fields1 = [["Customer Name","CustomerName"]];
            var fields2 = [["Return Rate","returnRate"],["AOV","AOV"]];
            return R.div(null,
              React.createElement(oms_searchField,{data: this.props.data}),
              React.createElement(more_details,{data: this.props.data}),
              React.createElement(oms_InsightsData,{data: this.props.data})
              
              
            );  
        }
      }
    frontend: true
  - name: templates/orderEvent.js
    mime: text/javascript
    text: "var oms_OrderEventData = class oms_OrderEventData extends React.PureComponent  {\r\n  constructor(props) {\r\n    super(props)\r\n  }\r\n  \r\n  render() {\r\n    console.log(\"oms_OrderDetailsData.render\");\r\n    var fields1 = [[\"Customer Abandonment\",\"churnScore\"]];\r\n    var fields2 = [[\"Return Rate\",\"returnRate\"],[\"AOV\",\"AOV\"]]//,[\"Previous Call Reason\",\"callReason\"]];,[\"Gross Annual Spend\",\"Revenue\"]\r\n    var fields4 = [[\"Shopper Affinity\",\"shopperAffinity\"]]//,[\"Cart Checkout Propensity\",\"callReason\"],[\"Upsell Purchase Probability\",\"callReason\"]]\r\n    var apiStatus = this.props.data.apiStatus\r\n    if(apiStatus == 1){\r\n      return R.div(null,\r\n      //R.b(null,this.props.data.CustomerSince),\r\n        React.createElement(oms_searchField,{data: this.props.data}),\r\n        React.createElement(oms_CLTVField,{data: this.props.data}),\r\n        React.createElement(oms_returnRiskField,{data: this.props.data}),\r\n        React.createElement(more_details,{data: this.props.data}),\r\n        React.createElement(oms_InsightsData,{data: this.props.data}),\r\n        R.br(null,null),\r\n        //R.details(null,\r\n          //R.summary(null, \"More Details\"),\r\n          //React.createElement(more_details,{data: this.props.data})\r\n      //)\r\n    );\r\n    }\r\n    else{\r\n        return R.div(null,\r\n          React.createElement(oms_OrderEventError,{data: this.props.data})\r\n      );\r\n  }\r\n  }\r\n}\r\n\r\n"
    frontend: true
  - name: templates/orderEvent.scss
    mime: text/x-scss
    text: "@mixin oms-logo() {\r\n  &:before {\r\n    content: \"EXPERT ASSISTANT\";\r\n    font-family: Didot, serif;\r\n    font-weight: 100;\r\n    font-size: 22px;\r\n    display:inline-block;\r\n    line-height: 30px;\r\n    color: white;\r\n    vertical-align: top;\r\n    margin-right: 20px;\r\n  }\r\n}\r\n.oms-root {\r\n  color: black;\r\n  font-family: Arial;\r\n  .btn {\r\n    &.btn-secondary,\r\n    &.btn-primary {\r\n      color: black;\r\n      &:disabled {\r\n        opacity: 0.5;\r\n      }\r\n      border: 1px solid black;\r\n      border-radius: 3px;\r\n      background-color: white;\r\n      &:hover, &:focus {\r\n        background-color: lightgrey;\r\n      }\r\n    }\r\n  }\r\n  strong, b {\r\n    font-weight: bold;\r\n  }\r\n  .cca-head {\r\n    padding-left: 15px;\r\n    background-color: black;\r\n    @include oms-logo();\r\n  }\r\n  &.oms-compact {\r\n    #cca-root > * {\r\n      overflow-y: auto;\r\n    }\r\n  }\r\n    ::-webkit-scrollbar {\r\n    width: 7px;\r\n}\r\n \r\n/* Track */\r\n::-webkit-scrollbar-track {\r\n    -webkit-border-radius: 10px;\r\n    border-radius: 10px;\r\n}\r\n \r\n/* Handle */\r\n::-webkit-scrollbar-thumb {\r\n    background: #ccc;\r\n    border-radius: 10px;\r\n    background: linear-gradient(left, #fff, #e4e4e4);\r\n    border: 0px solid #aaa;\r\n}\r\n  &.oms-compact .cca-conversation {\r\n    background-color: white;\r\n    @include oms-logo();\r\n    &:before {\r\n      position: fixed;\r\n      z-index: 100;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      margin: 0;\r\n      background-color: black;\r\n      padding: 5px 15px;\r\n    }\r\n    padding-top: 40px;\r\n    .cca-node {\r\n      margin: 0;\r\n      padding: 0;\r\n      .cca-node-feedback {\r\n        display: none;\r\n      }\r\n      .cca-node-content {\r\n        width: 100%;\r\n        & > strong,\r\n        .cca-node-message-actions,\r\n        .cca-node-content-data-bookmark {\r\n          display: none;\r\n        }\r\n      }\r\n      .cca-node-content-data {\r\n        box-shadow: none;\r\n        margin-top: 0;\r\n      }\r\n    }\r\n  }\r\n  .cca-conversation {\r\n    .cca-node-message {\r\n      border: none;\r\n    }\r\n  }\r\n  .cca-node-content-data {\r\n    .head {\r\n      &, & + br {\r\n        display: none;\r\n      }\r\n    }\r\n    .font-key {\r\n      font-size: 12px;\r\n    }\r\n    .font-value {\r\n      font-size: 12px;\r\n      font-weight: bold;\r\n    }\r\n    .padding {\r\n      padding-top: 8px;\r\n    }\r\n    .feedback {\r\n      display: flex;\r\n      margin-right: -20px;\r\n      & > * {\r\n        margin-top: 8px;\r\n        margin-right: 20px;\r\n      }\r\n    }\r\n    \r\n    .risk-customer {\r\n      margin-top: 10px;\r\n      margin-bottom: 8px;\r\n    }\r\n    \r\n    .facts-NBA-style {\r\n      padding-top: 11px;\r\n      .nba-index {\r\n        padding-top: 17px;\r\n        font-size: 10px;\r\n        font-weight: bold;\r\n      }\r\n      .nba {\r\n        padding-bottom: 10px;\r\n        .btn.btn-secondary.eba-url {\r\n          color: black;\r\n          font-family: Georgia;\r\n          font-size: 21px;\r\n          height: 31px;\r\n          padding-bottom: 8px;\r\n          padding-left: 1px;\r\n          padding-right: 1px;\r\n          border: none;\r\n          text-decoration: underline;\r\n        }\r\n        button {\r\n          margin-top: 5px;\r\n          margin-bottom: 10px;\r\n        }\r\n      }\r\n      .nba-fact {\r\n        margin-top: -10px;\r\n        width: 100%;\r\n        display: block;\r\n        height: fit-content;\r\n        overflow: hidden;\r\n        margin-bottom: 15px;\r\n        background-color: #E0EFFA;\r\n        border-radius: 4px;\r\n        color: #103855;\r\n        font-family: Arial;\r\n        font-size: 14px;\r\n        padding-left: 10px;\r\n        padding-top: 10px;\r\n        padding-right: 10px;\r\n        padding-bottom: 10px;\r\n        .padding-fact {\r\n          padding-left: 8px;\r\n          padding-top: 4px;\r\n        }\r\n      }\r\n    .nba-fact-delay {\r\n    margin-top: -10px;\r\n    width: 100%;\r\n    display: block;\r\n    height: fit-content;\r\n    overflow: hidden;\r\n    margin-bottom: 15px;\r\n    background-color: #FBE8E8;\r\n    border-radius: 4px;\r\n    color: #B60218;\r\n    font-family: Arial;\r\n    font-size: 14px;\r\n    padding-left: 10px;\r\n    padding-top: 10px;\r\n    padding-right: 10px;\r\n    padding-bottom: 10px;\r\n}\r\n    }\r\n  }\r\n}\r\n.hr {\r\n    height: 1px;\r\n    margin-top: 8px;\r\n    margin-bottom: 8px;\r\n    margin-left: auto;\r\n    margin-right: auto;\r\n    border-width: 0.3px;\r\n    background: #F0F0F0;\r\n    color: #F0F0F0;\r\n}\r\n.font-item {\r\n    font-family: Georgia, \"Times New Roman\", Times, serif;\r\n    font-style: italic;\r\n    font-size: 12px;\r\n    color: #000000;\r\n    padding-right: 5px;\r\n    padding-top: 10px;\r\n    padding-bottom: 10px;\r\n    padding-left: 8px;\r\n}\r\n.nba{\r\n   display: flex;\r\n   flex-direction: row;\r\n   padding-bottom: 11px;\r\n   padding-bottom: 10px;\r\n    .btn.btn-secondary {\r\n      &:hover {\r\n        background-color:white;\r\n      }\r\n      color: black;\r\n      font-family:Georgia;\r\n      font-size:21px;\r\n      height: 31px;\r\n      padding-bottom: 8px;\r\n      padding-left: 1px;\r\n      padding-right: 1px;\r\n      border-width: 0px\r\n    }\r\n    .btn.btn-secondary.eba-url{\r\n       &:hover {\r\n        background-color:white;\r\n      }\r\n      color: black;\r\n      font-family:Georgia;\r\n      font-size:21px;\r\n      height: 31px;\r\n      padding-bottom: 8px;\r\n      padding-left: 1px;\r\n      padding-right: 1px;\r\n      border-width: 0p;\r\n      text-decoration:underline;\r\n    }\r\n}"
    frontend: true
  - name: templates/common.jsx
    mime: text/jsx
    text: "var oms_InsightsData = class EventData extends React.PureComponent {\r\n        constructor(props) {\r\n          super(props)\r\n          this.state = { selectedAction: 0 , thumbsDisable: \"true\", disablenba: \"btn btn-secondary nba\"}\r\n        }\r\n        \r\n\r\n\r\n        handleNbaClick(e) {\r\n          let actionIndex = null\r\n          actionIndex = e.currentTarget.dataset.id\r\n          var data;\r\n          e.preventDefault();\r\n          if(this.props.data.NBAList.NBA[actionIndex].NBAType==\"CCUI-URL\" )\r\n          {\r\n            data = {\r\n              usecase: this.props.data.NBAList.NBA[actionIndex].ActionID,\r\n              EnterpriseCode: this.props.data.NBAList.NBA[actionIndex].NBAData.EnterpriseCode,\r\n              OrderNo: this.props.data.NBAList.NBA[actionIndex].NBAData.OrderNo,\r\n              nbaData: this.props.data.NBAList.NBA[actionIndex],\r\n              feedback: {\r\n              Feedback: 1\r\n            }\r\n            };\r\n            return parent.postMessage(data, \"*\");\r\n          }\r\n          else if(this.props.data.NBAList.NBA[actionIndex].NBAType==\"EBA-URL\")\r\n          {\r\n            window.open(this.props.data.NBAList.NBA[actionIndex].NBAData.URL);\r\n            return parent.postMessage(data, \"*\");\r\n          }\r\n          }\r\n          \r\n        handleThumbsUpNba(e){\r\n          \r\n          var data;\r\n          e.preventDefault();\r\n            data = {\r\n              usecase: this.props.data.NBAList.NBA[this.state.selectedAction].ActionID,\r\n              EnterpriseCode: this.props.data.NBAList.NBA[this.state.selectedAction].NBAData.EnterpriseCode,\r\n              OrderNo: this.props.data.NBAList.NBA[this.state.selectedAction].NBAData.OrderNo,\r\n              nbaData: this.props.data.NBAList.NBA[this.state.selectedAction],\r\n              CustomerID: this.props.data.NBAList.NBA[this.state.selectedAction].NBAData.customerID,\r\n              feedback: {\r\n              Feedback: 1\r\n            }\r\n            };\r\n            this.setState({disablenba:\"btn btn-secondary disablenba\"})\r\n          }\r\n        handleThumbsDownNba(e){\r\n          var data;\r\n          e.preventDefault();\r\n            data = {\r\n              usecase: this.props.data.NBAList.NBA[this.state.selectedAction].ActionID,\r\n              EnterpriseCode: this.props.data.NBAList.NBA[this.state.selectedAction].NBAData.EnterpriseCode,\r\n              OrderNo: this.props.data.NBAList.NBA[this.state.selectedAction].NBAData.OrderNo,\r\n              nbaData: this.props.data.NBAList.NBA[this.state.selectedAction],\r\n              CustomerID: this.props.data.NBAList.NBA[this.state.selectedAction].NBAData.customerID,\r\n              feedback: {\r\n              Feedback: -1\r\n            }\r\n            };\r\n            this.setState({disablenba:\"btn btn-secondary disablenba\"})\r\n\r\n          }\r\n        createNBA() {\r\n          let NBAlength = this.props.data.NBAList.len\r\n          let i = 0\r\n          let nextBestAction =[]\r\n          const divstyle = {\r\n            display: 'flex'\r\n          };\r\n          for(i=0;i<NBAlength;i++){\r\n            let buttonName = this.props.data.NBAList.NBA[i].Action\r\n            let entry1 = this.props.data.NBAList.NBA[i].NBATypeValue\r\n            let entry2 = this.props.data.NBAList.NBA[i].ActionID\r\n            let facts= this.props.data.NBAList.NBA[i].Facts\r\n            let cond = this.props.data.NBAList.NBA[i].Highlight\r\n            let len = this.props.data.NBAList.len\r\n            let actionIndex = i+1\r\n            let prefix = \"\"\r\n            let nbaType= \"\"\r\n            let suffix = \"\"\r\n            let left = \"\"\r\n            let right = \"\"\r\n            let display = \"\"\r\n            let disablenba = \"btn btn-secondary nba\"\r\n            let icon = null\r\n            if(this.props.data.NBAList.NBA[i].NBAType == \"EBA-URL\" )\r\n            {\r\n              display = \"btn btn-secondary eba-url\"\r\n              icon = <img src=\"https://208.43.43.60:8080/windowIcon.svg\" height=\"16\" width=\"16\" onerror=\"this.onerror=null;this.src='https://208.43.43.60:8080/windowIcon.svg';\"></img>\r\n            }else if(this.props.data.NBAList.NBA[i].NBAType == \"CCUI-URL\"){\r\n              display = \"btn btn-secondary eba-url\"\r\n            }\r\n            else{\r\n              display = \"btn btn-secondary\"\r\n            }\r\n            if(actionIndex == 1){\r\n              prefix = \"st\"\r\n            }else if(actionIndex == 2){\r\n              prefix = \"nd\"\r\n            }else if(actionIndex ==3){\r\n              prefix = \"rd\"\r\n            }else{\r\n              prefix = \"th\"\r\n            }\r\n            nextBestAction.push(<div className=\"facts-NBA-style\">\r\n                <div className=\"nba-index\">{actionIndex}{prefix} ACTION</div>\r\n                <div className=\"nba\">\r\n                  <button className={ display } onClick={this.handleNbaClick.bind(this)} data-id={i.toString()} title={nbaType}> {buttonName}&nbsp;\r\n                  </button>{icon}\r\n                </div>\r\n                <div>\r\n                    {facts.map((fact) => fact.toLowerCase().includes(\"delay\")?(<div className=\"nba-fact-delay\" style={divstyle}>&nbsp;<div ><span className=\"glyphicon glyphicon-info-circle\"/></div>&nbsp;<div className=\"padding-fact\">{fact}</div></div>):(<div className=\"nba-fact\" style={divstyle}>&nbsp;<div><span className=\"glyphicon glyphicon-info-circle\"/></div>&nbsp;<div className=\"padding-fact\">{fact}</div></div>))}\r\n                </div>\r\n                <div className=\"font-key\">Did you find it useful?</div>\r\n                <div className=\"feedback\">\r\n                  <div ><button className=\"btn btn-secondary nba-yes\" onClick={this.handleThumbsUpNba.bind(this)}>Yes</button></div>\r\n                  <div className=\"space\"><button className=\"btn btn-secondary nba-no\" onClick={this.handleThumbsUpNba.bind(this)}>No</button></div>\r\n                </div>\r\n              </div>)\r\n        }\r\n        return nextBestAction\r\n        }\r\n        render() {\r\n          const divstyle = {\r\n            color: 'red',\r\n            display: 'inline-block'\r\n          };\r\n          const exclaimatory = {\r\n            color :\"blue\",\r\n            display: 'inline-block'\r\n          }\r\n          \r\n          console.log(\"oms_InsightsData.render\");\r\n          let indexNo = this.state.selectedAction + 1\r\n          let buttonName = this.props.data.NBAList.NBA[this.state.selectedAction].Action\r\n          let entry1 = this.props.data.NBAList.NBA[this.state.selectedAction].NBATypeValue\r\n          let entry2 = this.props.data.NBAList.NBA[this.state.selectedAction].ActionID\r\n          let facts= this.props.data.NBAList.NBA[this.state.selectedAction].Facts\r\n          let cond = this.props.data.NBAList.NBA[this.state.selectedAction].Highlight\r\n          let len = this.props.data.NBAList.len\r\n          let nbaType= \"\"\r\n          let suffix = \"\"\r\n          let left = \"\"\r\n          let right = \"\"\r\n          let display = \"btn btn-secondary\"\r\n          let disablenba = \"btn btn-secondary nba\"\r\n          \r\n          \r\n          let ThumbsUpAndDown = null\r\n          \r\n          if (this.props.data.NBAList.NBA[this.state.selectedAction].NBAType == \"CCUI-INFO\"){\r\n            ThumbsUpAndDown = <div className=\"nba-block\"><button className={this.state.disablenba} onClick={this.handleThumbsUpNba.bind(this)} disable={this.state.thumbsDisable}><ThumbsUpIcon/></button><button className={this.state.disablenba} onClick={this.handleThumbsDownNba.bind(this)} disable={this.state.thumbsDisable}><ThumbsDownIcon /></button></div>\r\n            nbaType = \"INFORMATORY\"\r\n            display = \"btn btn-secondary disable\"\r\n          }\r\n          if(len>1)\r\n          {\r\n            left = <span className=\"glyphicon glyphicon-chevron-left-double\"/>\r\n            right = <span className=\"glyphicon glyphicon-chevron-right-double\"/>\r\n          }\r\n          return this.createNBA()\r\n        }\r\n      } "
    frontend: true
